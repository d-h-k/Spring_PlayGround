# 스프링이 지원하는 프록시 학습정리
- 학습일자 : 2022년 2월 8일
- 오리지널 콘텐츠 : 인프런 김영한님 강의 (스프링 고급)
  - 섹션 6. 스프링이 지원하는 프록시

## 잠깐 복습
- CGLIB 제약
  - 상속기반의 프록시
  - 부모클래스의 생성자를 체크해야하는데, 자식클래스를 (알아서/몰래) 생성하기때문에
  - final 키워드를 붙일 수 없다는 제한이 생기는데, 클래스 final 키워드를 붙이면 상속이 제한되고, 메서드에 final 키워드를 붙이면 오버라이딩이 제한되기때문에 불가능하다
  - JPA/hibernate 에서 기본생성자를 강제하고 final 키워드를 붙이지 못하는 이유
- JDK-Dynamic
  - 인터페이스 기반의 프록시
  - 인터페이스가 필수여서 클래스만 있으면 적용할수 없다.

## Factory 로 문제해결
- 구현체인 JDK-Dynamic/CGLIB 에 의존하지 않고, 편리하게 동적으로 프록시를 생성하기 위해 프록시를 찍어내는 공장을 만들었습니다 ``ProxyFactory``
- 또, 프록시를 사용하는 이유인 (크로스컷)공통관심사 처리를 위해 Advice 라는 추상화된 새로운 개념을 도입
- 크로스컷을 어떤조건에 추가하고 / 어떤 기능을 추가할지를 편하게 추가할수 있다 (자세한 내용은 뒤에서)

## ProxyFactory 사용
- ProxyFactory.setProxyTargetClass(true/false) 
  - 이 메서드에서 true 를 인자로 넣어주면 CGLib 기반으로 동작
  - target class 기반으로 프록시를 만들겠다는 의미이며, 실무에서 많이 쓰이니까 기억
- 프록시팩토리 기술 내부 동작
  - 1\) 인터페이스가 있으면 : JDK-다이나믹
  - 2\) 인터페이스 없으면 CGLib
  - 3\) setProxyTargetClass\(true\) : 무조건 CGLib
- SpringBoot AOP 는 기본 CGLIB 적용되서 사용함

## Advice 개념의 도입
- 프록시팩토리를 도입해서, 프록시를 만들고 이런 "구현" 에 대한 이야기 말고 원래의 목적
- 공통관심사 처리를 깔끔하게 하는 코드를 만드는데, 이 공통관심사에서 해야할 일이 Advice
  

## 디테일
- 강의에서 사용하는 `MethodInvocation` 클래스는 `aopallience` 패키지를 사용해야함
- 프록시 팩토리는 target 을 이미 알고계신데
- 여전히 Type-Casting 을 해줘야한다
- 프록시가 어떤 기술로 만들어져 있는지 체크할수 있는 메서드가 제공된다
  - isAopProxy/isJDKDynamicProxy/usCglibProxy

## 키워드 정리 : 포인트컷/어드바이스/어드바이져
- 포스트잇으로 잔소리 하는 메타포로 정리
### 포인트컷 : 어디에다가 포스트잇을 붙일지
### 어드바이스 : 잔소리할 포스트잇의 내용
### 어드바이저 = 포인트컷+어드바이스
- 포스트잇을 붙여 잔소리를 함
- ![](https://user-images.githubusercontent.com/31065684/152969926-7ca94164-1ef8-478c-a053-2c1b24adde99.png)
- SRP! 역할과 책임의 분리
